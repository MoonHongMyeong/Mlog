## 2021 01 15
#### 프로젝트 시작 개인 블로그를 구현하고 싶음.<br> 테이블 구성은 작성자(주인), 사용자(손님), 카테고리, 포스트, 댓글, 태그로 구현을 생각하지만 처음 JPA를 다루는 부분이기도 하고 배포할 때 개인정보관리같은 문제가 있을것 같아서 회원기능은 제외. 태그나 카테고리는 언제든지 추가 할 수 있을 것 같아서 제외했더니 남은 것이 포스트와 댓글 밖에 없었다. 익숙한 maven을 사용하지 않고 gradle을 사용해보고 싶었다. 기본적으로 기존에 사용한 것들 보다 새로운 것을 배우면서 프로젝트를 완성하는데 중점을 둘 생각이다. 

---

## 2021 01 17
#### 기본적인 틀을 잡았다. 엔티티들을 관리할 도메인 패키지, 컨트롤러와 Dto들을 관리할 web패키지, 서비스 패키지도 따로 만들었고 친숙한 application.properties에서 YAML형식-application.yml-으로 바꿔봤다. 생각보다 익히기 어렵지 않았고 처음 빌드할 때 메이븐으로 하지 않고 그레이들을 사용해봐서 그런지 가독성도 좋은것 같다.

---

## 2021 01 22
#### JPA가 많이 어렵다;; 러닝커브가 높다고 하더니 확실 높은 것 같다.... 영속성 컨텍스트부터 라이프 사이클까지 후........
#### posts와 comments 엔티티를 작성하고 연관관계 매핑을 했다. 
#### posts crud기능을 RestAPI를 생각하면서 구현했다. 기본적인 도메인에 api부분은 생략들을 많이 한다던데 일단 넣었다. 대신에 버전부분을 뺐다. 
#### /posts 전체 포스트 조회
#### /posts/form 포스트 작성 폼으로 이동GET, 포스트 작성POST
#### /posts/{postsId} postsId의 포스트를 조회GET, 수정PUT, 삭제DELETE
#### /posts/{postsId}/comments 포스트의 댓글 리스트 조회GET, 댓글 작성POST
#### /posts/{postsId}/comments/{commentsId} 댓글의 수정PUT 삭제DELETE 대댓글작성POST 댓글을 개별로 조회할 필요는 없으니 GET은 뺐다.

---

## 2021 01 23
#### 모든 테이블에 createdDate와 modifiedDate는 필요하다고 생각해서 BaseTimeEntity를 작성하고 Posts와 comments 엔티티에 상속 시켰다. 타입은 LocalDateTime으로 했기 때문에 실행어플리케이션에 EnableJpaAuditing 어노테이션을 추가했다.
#### PostsRepositoryTest와 CommentsRepositoryTest를 작성했다. 결과는 test passed

---

## 2021 01 26
#### 기본적인 포스트와 댓글 컨트롤러 서비스를 작성했다.
#### PostsApiControllerTest, CommentsApiControllerTest를 진행했다. 결과는 test passed

---

## 2021 01 27 
#### create-react-app 으로 프론트 작업할 blog-frontend 폴더를 생성하고 CSS적인 요소들은 Blex.me 사이트를 참고해서 컴포넌트 제작을 시작했다. 이 사이트를 고른이유는 블로그로 포트폴리오 프로젝트를 만들어봐야겠다는 글을 보기도 했고, 개인적으로 디자인이 마음에 들었기 때문이다.
#### footer를 만들고 nav버튼을 제작했다 최대한 비슷하게 작성하려고 노력했음. 네비게이션 부분은 똑같이 하지 않고 왼쪽에 미리 랜더링한 nav부분을 옮기는 방향으로 했다.

---



## 2021 01 29
#### PostView컴포넌트를 작성했다. PostView컴포넌트 안에 여러 컴포넌트를 배치할까 생각했다가 일단 그냥 작성했다. props를 계속 넘겨주는 것보다 어차피 서버와 작용을 할 필요도 없는 부분까지 세세하게 나눌 필요성을 못느꼈다. styled-components를 사용했다. 확실히 편해졌다. 그냥 컨테이너라고 만들어서 안에 css파일처럼 작성을 해놓고 사용했다. 이게 맞는 방법일까?

---

### 2021 01 30
#### 백엔드 api 구현 끝났고 CORS문제 해결을 위해 React에서는 package.json에 proxy설정을 넣었고, 스프링 부트에서는 @Cross-Origin 어노테이션을 사용했다
```
  CORS? 
  현재 존재하는 도메인과 정보를 불러오는 도메인에 차이가 생기면 보안 때문에 자동으로 차단
```
#### 여전히 프론트 작업 중인데 포스트 리스트, 기본 UI, 뷰 포스트까지는 구현했다. 아 코멘트 폼도
#### 폼부분들은 class 컴포넌트로 작성했는데 아 리액트 훅이 너무 좋네 다음에 작성하는 것들은 전부 훅을 써서 함수형 컴포넌트로 작성해야겠다.
#### 안되는 부분 포스트 수정화면 하고 댓글리스트 안불러와짐.....;;

---

## 2021 02 01
#### 백엔드 api수정
#### PostList 컴포넌트를 작성 중에 Posts엔티티에 사진을 안넣은 것을 확인했다.
#### 방법을 고민하다가 그냥 글만 받아왔을 떄는 @RequestBody를 사용해도 됐지만 파일이 들어오다보니 json이 아닌 form-data로 요청을 해야했고 @RequestParam으로 form 안에 데이터를 전부 받아와서 이미지 파일은 따로 리액트에서 불러올 수 있는 폴더를 만들어 저장하고 저장한 이미지url만 가져와서 Dto로 가공해서 데이터베이스에는 imageURL만 들어가게 했다.
#### PostApiControllerTest의 포스트 저장 메서드를 바꿔야했다. 파일이 따로 받지 않으면 default 이미지 경로를 주는 방식을 선택했는데 -이떄 image.isEmpty() 와 image == null조건의 차이를 알았다.- 따로 테스트 파일을 resources에 넣고 테스트를 실행했을 때 자꾸 실패를 했다. restTemplate가 제대로 일을 하지 못하는 것 같다. 테스트는 성공하는데 로그를 읽어보면 200이 나와야 성공인데 400이 나오는데도 테스트는 성공했다.

---

## 2021 02 02
#### 그냥 임의의 파일을 만들어서 테스트를 진행 => 
#### ByteArrayInputStream에서 예외가 발생 바이트 문제 인것 같아서 ByteArrayResource로 새로 Resource를 생성해서 테스트를 진행 =>
#### 여전히 400에러가 발생함 =>
#### 그래서 그냥 리소스를 통째로 만들어서 테스트를 진행했다. 결과는 패스 
#### PostList컴포넌트에 PostCard컴포넌트들을 배치했고 제대로 사진도 나왔다.
#### 포스트 작성은 작성 완료후에 다시 목록으로 가거나 해당포스트로 이동시켜버러기 때문에 백엔드에서 아무데이터나 넘겨줘도 됐지만 댓글리스트는 한 페이지내에서 작성이 완료되면 바로 랜더링 되야하기 때문에 데이터를 ResponseEntity로 해야할 필요성을 느낌

---

## 2021 02 03
#### post, comment, reply 컴포넌트를 전부 작성했다.
#### 남은것 : 검색구현, 페이징, 단위테스트, 배포, markdowna api(이건 전부 끝나고 마지막에 넣을 것)
#### 페이징 : JPA Pageable있으니 딱히 걱정할건 없는듯
#### 검색구현 : Querydsl사용하고 싶은데 시간이 너무 걸릴것 같으면 JPQL로 대체할 것
#### 단위테스트 : 프론트부분에서 필요한게 생기다보니 백엔드 부분도 자꾸 만져버렸는데 수정할 때마다 단위테스트를 작성하지 않음. 기능 완성되서 프론트랑 상호작용 잘되면 그때 한번에 작성해야겠다......ㅜㅜ
#### 배포 : 사실 이게 제일 큰 문제다. 책 한권 실습해본게 전부인데 커버가 가능할까?
#### 사실 styled-components를 내 방식대로 쓰는건 아닌것 같긴한데 ㅋㅋ;; 반응형 페이지로 만들어 보고 싶어서 컨테이너에 css전부 박아 넣는것은 아닌것 같다. 최근에 velopert님꺼 유튜브 라이브 보면서 라이아웃 부터 짜가는 방식이 정말 실무에 맞는 방식인 것 같다.... 이건 리펙토링으로 커버해보자.... 부탁한다 미래의 나

---

## 2021 02 04
#### 전부 다 렌더링이 잘되는데 댓글 부분이 렌더링이 안된다.. 새로고침하면 데이터가 나오는데 내가 원하는건 폼에 작성을하고 등록 버튼을 누르면 뭐 댓글 작성완료 같은것으로 표시해주고 바로바로 아래 랜더링 되야하는데...

---

## 2021 02 05
#### 방법을 찾았다. 컴포넌트 자체를 Comment에 commentform을 넣고 리스트를 아래 넣는 형식으로 해서 댓글은 SingleComment 대댓글은 ReplyComment로 구현했는데 처음 데이터를 불러오는곳은 Comment컴포넌트를 가진 PostView 컴포넌트에서 댓글리스트를 불러오는 것이라서 안됐다.
#### PostView 컴포넌트에서 댓글을 다시 랜더링하는 함수를 계속해서 자식한테 물려주는 방법으로 해결했다.

---

## 2021 02 06
#### 검색구현 부분도 그냥 css같은 걸 써서 프론트 단에서 구현을 할까 생각헀지만 Querydsl을 사용해서 구현했다. querydsl 너무 좋은데 블로그에서 뭐 포스트 제목 정도 밖에 검색할 건덕지가 없어서 너무 조금 쓴것 같긴하지만 사용방법을 알았다는데 의의를 두자.
#### 페이징도 jpa pageable을 쓸까 프론트단에서 해결할까 고민했는데 jpa강의를 들을 때 DB에 접속하는게 적으면 적을수록 좋다고 했던 기억이나서 그냥 useState를 사용해서 페이징을 구현했다.

## 2021 02 07
#### 얼추 validation까지 전부 만든 것 같고 슬슬 배포를 준비 해야할 것 같아서 AWS에 가입 프리티어 서비스를 이용하기로 했다. 실제 서비스할 것도 아니고 포트폴리오용인데 굳이 유료로 좋은 서버 RDS써야 할까 싶다.
#### EC2 Linux AMI 와 MySQL 5.x 버전 RDS를 사용하기로 결정 지금까지 커밋만 해왔던 것들을 푸시해서 업로드 했고, EC2서버에 있는 자바 7버전을 삭제하고 11버전을 설치, node, npm, yarn을 설치했다.
#### 실제 중요한 자료를 가지고 있는 yml파일은 깃에 업로드 할수가 없어서 직접 vim에디터로 작성했고
#### 그레이들 빌드 중에 테스트 코드에 @AfterEach에 포스트에 있는 모든 데이터 삭제를 수정했다.
#### 8000번 포트에 스프링부트를 3000번 포트에 리액트를 실행시켰더니 잘 작동했다.

---

## 2021 02 08
#### 스프링부트 빌드해서 실행하고 리액트 그냥 실행했더니 localhost라고 한 부분에서 문제가 생김.. 전부 바꿔주고 다시 시작. 잘된다.
#### 잘되는데 실제로 쓰는 포트는 http(80번 포트), https(443번 포트)인데 지금 리액트가 3000번 포트를 가리켜서 도메인뒤에:3000을 해줘야 작동함 그냥 도메인으로 접속하면 당연히 안되지 ㅡㅡ;
#### 그래서 이 부분을 package.json에서 스타트 부분에 export PORT=80, 을 추가해서 80번포트에서 리액트를 작동시켜보려했지만 실패 1024아래 포트는 관리 권한이 필요하다고 한다...
#### 그래서 생각한게 Nginx 엔진엑스로 80, 443포트에서 리엑트 포트를 가리키고 3000번포트와 8000번포트끼리 상호작용하면 될 것 같았는데 프록시 에러가 장난이아니다....ㅜㅜㅜㅜㅜㅜㅜㅜㅜㅜ

---

## 2021 02 09
#### 엔진엑스 80번, 리액트3000번, 스프링부트 8000번으로 실행해서 리액트(3000)와 스프링부트(8000)가 서로 통신하고 새로운 배포를 파일 업로드 했을 때 새롭게 리액트(3001), 스프링부트(8001)실행하고 엔진엑스로 3001번 포트를 가리키는 방향으로 해보려고 했는데
#### 1.프록시 에러가 터짐<br>localhost를 못 읽는 것 같다 AMI에서는
#### 그래서 2.리액트를 빌드하고 엔진엑스로 빌드파일을 가리키고 스프링부트와 통신하기를 바랬는데 미친 엔진엑스에서는 포스트에 정적파일(여기서는 이미지)가 들어가면 405에러를 발생;;; 리스트를 로딩할 때도 304를 뱉음 내가 원하는게 안나옴 ㅜㅜㅜㅜㅜㅜㅜㅜ
#### 3.리액트도 아예 스프링부트에 같이 빌드시켜서 엔진엑스로 스프링부트를 가리키는 방법을 시도했다.
#### 일단 스프링 부트에 리액트까지 함꼐 빌드업 시키고 엔진엑스로 스프링부트를 가리키면 어떻게 되는지 봐야겠다.
#### 리액트 빌드파일을 스프링 부트에 넣어서 구동시켜봤다. CORS때문에 이상한 것등르 뱉는거였다. 메인페이지와 포스트폼페이지 처음 index에서 구동 된 녀석들은 잘 작동했지만 폼에서 글작성후 해당글로 이동하던가 하면 구동 뷰가 보이지 않고 json으로만 보이는 현상이 발견되었다. 이부분은 router처리하지 않고 직접 window.location.href를 써서 해당 주소로 이동시킨게 문제인 것 같다.

---

## 2021 02 10
#### Nginx 80번포트로 리액트를 빌드시킨 것을 가리키게하고 8000번 스프링부트와 api연동을 성공 시킴(2번 방법) 중간에 CORS터져서 진땀 좀 뻈음.
#### 새로고침하거나 주소가 "/"이 아닌 다른 주소를 입력하면 화면에 그냥 api서버 접속한 것처럼 json으로만 보임 이건 새로고침하게 하지말고 라우터로 어떻게 해볼 수 있을것 같음. => 라우터로 해결함.
#### 현재 작동은 잘되고 있음.
#### 앞으로 해결해야할 문제가 자동배포시스템 deploy.sh나 CI travis나 jenkins 이런애들이 필요할것 같은데
#### 아 그냥 80포트 엔진엑스로 3천번 리액트 8천번 스프링부트 생각대로 됐으면 쿠버네티스 사용해서 리액트랑 스프링부트 꺼지는거 실시간으로 확인하고 재실행 시켜주는 방법으로 가고 싶었는데 ㅡㅡ
#### Nginx로 빌드된 리액트 파일을 가리키게된 이유 : 원래는 그레이들 빌드시에 리액트도 yarn build 해서 스프링 부트의 static폴더로 가져오는게 목표였는데, 그렇게 빌드파일을 짜고 실행하니까 서버 메모리 초과로 작동을 안한다...;; T.micro 1GB메모리의 한계인가 보다....
#### 그래도 어느정도 구색은 갖춰줬으니 포트폴리오로 잘 정리해서 취업준비하면서 나머지 기능들을 추가해야겠다.

---

## 2021 02 11
#### 추가해야겠다고 생각한 것들
#### 회원기능 추가하면 JPA에 author컬럼부분 전부 User엔티티로 갈아치워야되고 연관관계 매핑도 다시해야함<br>일단 회원은 이름 이메일 사진 롤(스프링 시큐리티)로 구성할 것 같고 OAUTH2.0,SpringSecurity 사용해서 구글 깃허브 로그인 구현이 회원기능 구현 목표.

<br>

#### deploy.sh설계를 음 깃 풀이 되면 프론트엔드 폴더가서<br> yarn install하고 <br>yarn run build --prod해서<br> 빌드파일 만들어지면 <br>nginx재시작 sudo service nginx restart<br>백엔드 폴더/src/main/java/resource 폴더생성하고<br>사용자 폴더에 있는 application.yml복사 시키고<br>chomod +x gradlew 그레이들 권한주고<br> 빌드 ./gradlew build<br> 빌드 끝나면 build/libs 들어가서<br>nohup으로 실행 nohup java -jar [jar파일] &<br>하면 되겠는데?

<br>

#### 리액트 리팩토링도 해야한다 ㅜㅜㅜ;<br>회원 정보창은 따로 구현할 필요없을 것 같고<br>로그인 로그아웃 회원가입 회원탈퇴 4가지만 구현하면 될 것 같다. 공지창도 만들어야겠다 회원가입해서 테스트 해보고 바로 탈퇴하라고 구글로그인하고 깃허브로그인으로 회원기능을 만들거라서 직접 사용하고 있는 것들로 테스트를 해야함 그러니까 공지창도 만들어야겠다.  테스트 끝나면 회원탈퇴 꼭 눌러달라고

<br>

#### 배포를 하는데 깃 풀을 땡겨야되서 문제가 생기면 커밋을 해서 확인을 해봐야되기 때문에 커밋을 남발하는 부분이 있는것 같다....... 실제 로컬하고 인스턴스 환경 차이때문인 것 같다. 로컬에서 테스트 했을 떄는 잘됐는데;;<br>이런 부분 떄문에 도커로 같은 환경을 만들어 주는것 같다.

#### 깃을 처음 써서 그런지 깃의 브런치 관리전략 같은것을 한번도 생각해 본적이 없는데 읽어 보니까 협업을 하는데 꼭 필요한 부분인것 같다, 혼자 하니까 마스터 브랜치에 커밋남발했지.....<br>현재 관리전략으로 git flow를 생각중이다...